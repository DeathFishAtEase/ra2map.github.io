import{_}from"./ValaxyMain.vue_vue_type_style_index_0_lang-YzXWt1l6.js";import{_ as m}from"./TxDownload.vue_vue_type_style_index_0_lang-DgfgHHZg.js";import{i as p,p as u,o as h,k as y,w as l,h as f,g as c,l as e,a as t,b as o}from"./app-DgD459NU.js";import"./helper-f8z8uJIo.js";import"./tags-DGLoaXLD.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-CoFRrmAh.js";import"./YunCard.vue_vue_type_script_setup_true_lang-CNPdkDqR.js";import"./index-C5okkQwF.js";import"./YunPostMeta.vue_vue_type_style_index_0_lang-CUP4BrpA.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-D17pr_Qp.js";import"./post-C-tZkxQQ.js";const b="/assets/01-B0rd97c6.jpg",$="/assets/02-CyJg3Zba.jpg",A=t("blockquote",null,[t("p",null,[o("Ra2map：本文转载自"),t("a",{href:"http://pkuit.com/forum.php?mod=viewthread&tid=204594&extra=page%3D1",target:"_blank",rel:"noreferrer"},"【教程】平台bug：注册号漂移 - 红警任务之家")])],-1),v=t("p",null,[t("em",null,"本教程整理自我在2021.5.10回复visa6000提问的邮件。感谢他的提问。")],-1),N=t("p",null,"相信不少任务制作者都遇到过一个坑：",-1),T=t("p",null,[o("在FinalAlert中，有些地方需要使用"),t("strong",null,"注册号"),o("作为触发或者脚本的参数（比如触发条件“19 建造特定类型的建筑…”，触发结果“41 播放动画在…”，脚本“移动到己方建筑”等）。")],-1),S=t("p",null,[o("但我们时常发现，在使用原版的rules文件时，对于一些序号比较大的建筑或者动画，"),t("strong",{style:{color:"blue"}},"游戏内部实际起作用的序号"),o("（就是“填写这个注册号，触发和脚本才会正确的起作用”，下文全部用"),t("strong",{style:{color:"blue"}},"蓝色"),o("表示）、"),t("strong",{style:{color:"green"}},"地图编辑器中显示的序号"),o("（就是“地图编辑器下拉框中，我所需要的正确物品的名称对应的序号”，下文全部用"),t("strong",{style:{color:"green"}},"绿色"),o("表示）和"),t("strong",{style:{color:"red"}},"在rules文件中这一条目的注册号"),o("（下文全部用"),t("strong",{style:{color:"red"}},"红色"),o("表示）是存在差异的，或者说，是有“漂移”的。")],-1),k=t("p",null,[o("先举一个例子说明这三种序号的差别，以建筑列表的"),t("strong",null,"尤里建造厂"),o("为例：")],-1),w=t("ul",null,[t("li",null,[t("strong",{style:{color:"red"}},"在rules文件中这一条目的注册号——305"),o("：在rulesmd.ini中可以查到，"),t("strong",{style:{color:"red"}},"305=YACNST")]),t("li",null,[t("strong",{style:{color:"green"}},"地图编辑器中显示的序号——301"),o("：在地图编辑器中的下拉框中可以看到，"),t("strong",{style:{color:"green"}},"301 尤里建造厂")]),t("li",null,[t("strong",{style:{color:"blue"}},"游戏内部实际起作用的序号——300"),o("：经过试验可以确认（地图编辑器里面300号是"),t("strong",{style:{color:"blue"}},"公车站"),o("，囧）。")])],-1),B=t("figure",null,[t("img",{src:b,alt:"",loading:"lazy",decoding:"async"})],-1),z=t("p",null,"这种漂移在建筑序号中是漂移一点点，但在动画列表中就是大幅度跳跃了。",-1),C=t("p",null,[o("一个非常典型的例子就是超时空传送效果的动画，"),t("strong",null,"CHRONOTG"),o("，其正确的内部号码是"),t("strong",{style:{color:"blue"}},"257"),o("，然而在rulesmd的[Animations]注册表中的注册号是"),t("strong",{style:{color:"red"}},"668"),o("，在地图编辑器中显示的号码是"),t("strong",{style:{color:"green"}},"261"),o("。如果按照后两个号码来填写，前者会导致游戏直接出错，后者会播放错误的动画。")],-1),P=t("hr",null,null,-1),Y=t("p",null,"这种漂移已经算是bug了。那么这个bug有没有规律可言呢？答案是有的。",-1),D=t("p",null,[o("在阅读原版的rulesmd.ini的时候，你会发现这些列表中的注册是有"),t("strong",null,"重复"),o("的，也有序号大幅度"),t("strong",null,"跳跃"),o("的状况：")],-1),O=t("figure",null,[t("img",{src:$,alt:"",loading:"lazy",decoding:"async"})],-1),Z=t("p",null,[o("上图是原版的rulesmd.ini中[Animations]注册表的一部分。可以注意到有效的注册号并不是连续的，"),t("strong",{style:{color:"red"}},"318"),o("之后跳到了"),t("strong",{style:{color:"red"}},"321，334"),o("之后直接跨越到了"),t("strong",{style:{color:"red"}},"500"),o("，然后又跳步到"),t("strong",{style:{color:"red"}},"510"),o("。游戏内部读取这些动画的时候，明显是按照读取的顺序，给每一项"),t("strong",{style:{color:"blue"}},"重新依次编号了"),o("。")],-1),R=t("p",null,[o("种种迹象表明，从"),t("strong",{style:{color:"red"}},"在rules文件中的注册号"),o("到"),t("strong",{style:{color:"blue"}},"游戏内部实际起作用的序号"),o("之间，重新编号的规律是这样的：")],-1),V=t("ul",null,[t("li",null,"从上到下按顺序读取每一个项目。"),t("li",null,"空白的项目（只有注册号，等号后面没有东西）原样保留，不进行合并和删除。"),t("li",null,"非空的重复项目，以先读取的项目为准，后面的会被删除。"),t("li",null,"读取所有项目以后，再从头到尾从0开始重新编号。")],-1),j=t("p",null,"如果你有编程基础，你可以写一个程序来处理这种改变。",-1),H=t("p",null,[o("而地图编辑器读取序号的时候，处理了“跳步”的问题，但是没有处理“重复”的问题，这导致"),t("strong",{style:{color:"green"}},"地图编辑器中显示的序号"),o("与另外两种序号可能都不一样。")],-1),J=t("hr",null,null,-1),G=t("p",null,[o("下面举一个例子，以开头的"),t("strong",null,"尤里建造厂"),o("为例，手工分析一下各种序号的漂移状况：")],-1),K=t("p",null,[o("建筑列表的注册号从"),t("strong",{style:{color:"red"}},"1=GAPOWR"),o("开始的（而不是从0开始，这直接导致了漂移1号）；在"),t("strong",{style:{color:"red"}},"253、273和304"),o("各跳了1号；而"),t("strong",{style:{color:"red"}},"241=NAPSYA和185=NAPSYA"),o("注册了两次。没有其余的异常状况。")],-1),q=t("p",null,[o("因此对于"),t("strong",{style:{color:"red"}},"305=YACNST"),o("：")],-1),x=t("ul",null,[t("li",null,[t("strong",{style:{color:"blue"}},"游戏内部实际起作用的序号"),o("漂移了5号，因此是"),t("strong",{style:{color:"red"}},"305"),o("-5="),t("strong",{style:{color:"blue"}},"300")]),t("li",null,[t("strong",{style:{color:"green"}},"地图编辑器中显示的序号"),o("相对"),t("strong",{style:{color:"blue"}},"游戏内部实际起作用的序号"),o("只漂移了1号（只有“NAPSYA注册了2次”影响它），因此是"),t("strong",{style:{color:"blue"}},"300"),o("+1="),t("strong",{style:{color:"green"}},"301")])],-1),F=t("p",null,"其实对于建筑列表，由于地图编辑器中显示的序号相对游戏内部实际起作用的序号只受“NAPSYA注册了2次”影响，因此就是241之前不漂移，241之后漂移1号，就这么简单。",-1),M=t("p",null,"至于动画列表的漂移状况十分复杂，我还是用程序来处理吧……",-1),U=t("hr",null,null,-1),W=t("p",null,"说了这么多，有什么可以直接使用的结论吗？",-1),E=t("p",null,"有。",-1),I=t("p",null,"（2021.5.23更新：修复了由于搞错一个物体注册多次时的判定顺序而引发的局部漂移。）",-1),L=t("p",null,"这其中的两个文件就是经过程序处理完毕的原版[Animations]和[BuildingTypes]注册表。你可以有两种办法来使用它：",-1),Q=t("ul",null,[t("li",null,[o("在你需要寻找某一个物体"),t("strong",{style:{color:"blue"}},"游戏内部实际起作用的序号"),o("的时候，就可以在对应的文件里面查找，找到的就是正确的序号，填到地图编辑器里面没问题。")]),t("li",null,[o("把这两个文件里面的列表复制到rulesmd.ini里面，覆盖原来的列表（如果你添加了新的物体，在后面按顺序正常注册即可）。覆盖完成以后，"),t("strong",{style:{color:"blue"}},"游戏内部实际起作用的序号"),o("、"),t("strong",{style:{color:"green"}},"地图编辑器中显示的序号"),o("和"),t("strong",{style:{color:"red"}},"在rules文件中这一条目的注册号"),o("会变得完全一致，也就是一劳永逸的修复了这个bug。")])],-1),X=t("hr",null,null,-1),tt=t("p",null,"2021.5.21更新：",-1),ot=t("p",null,"我把计算注册号漂移的JavaScript程序打包进了一个网页，这样无需别的运行环境，只要一个浏览器就能打开运行了：",-1),lt=t("p",null,"（2021.5.22更新：修复了自动合并空条目的bug。现在不会合并空条目，与游戏内部表现一致。）",-1),st=t("p",null,"可以直接使用这个程序导入你的rulesmd.ini来计算正确的注册号。",-1),et=t("p",null,"2021.5.23更新：",-1),nt=t("p",null,"更改了一处错误的程序逻辑：一个物体注册多次，应该以先出现的那次为准，而非后出现的。",-1),$t={__name:"index",setup(rt,{expose:d}){const n=JSON.parse('{"title":"平台bug：注册号漂移","description":"","frontmatter":{"title":"平台bug：注册号漂移","date":"2021-05-15T16:00:00.000Z","updated":"2021-05-22T16:00:00.000Z","categories":"触发与小队","tags":["进阶"],"author":"竹蜻蜓(Heli)","sponsor":false},"headers":[],"relativePath":"pages/posts/platform-bug-registration-number-shift/index.md","path":"C:/code/web/valaxy-blog/pages/posts/platform-bug-registration-number-shift/index.md","lastUpdated":null}'),i=p(),r=n.frontmatter||{};return i.meta.frontmatter=Object.assign(i.meta.frontmatter||{},n.frontmatter||{}),u("pageData",n),u("valaxy:frontmatter",r),globalThis.$frontmatter=r,d({frontmatter:{title:"平台bug：注册号漂移",date:"2021-05-15T16:00:00.000Z",updated:"2021-05-22T16:00:00.000Z",categories:"触发与小队",tags:["进阶"],author:"竹蜻蜓(Heli)",sponsor:!1}}),(s,at)=>{const a=m,g=_;return h(),y(g,{frontmatter:f(r)},{"main-content-md":l(()=>[A,v,N,T,S,k,w,B,z,C,P,Y,D,O,Z,R,V,j,H,J,G,K,q,x,F,M,U,W,E,c(a,{size:"5.32KB",netdisk:"",direct:"rules注册号漂移计算-Downloads.zip",name:"rules注册号漂移计算-Downloads.zip"}),I,L,Q,X,tt,ot,c(a,{size:"8.95KB",netdisk:"",direct:"rules注册号漂移计算.html",name:"rules注册号漂移计算.html"}),lt,st,et,nt]),"main-header":l(()=>[e(s.$slots,"main-header")]),"main-header-after":l(()=>[e(s.$slots,"main-header-after")]),"main-nav":l(()=>[e(s.$slots,"main-nav")]),"main-content":l(()=>[e(s.$slots,"main-content")]),"main-content-after":l(()=>[e(s.$slots,"main-content-after")]),"main-nav-before":l(()=>[e(s.$slots,"main-nav-before")]),"main-nav-after":l(()=>[e(s.$slots,"main-nav-after")]),comment:l(()=>[e(s.$slots,"comment")]),footer:l(()=>[e(s.$slots,"footer")]),aside:l(()=>[e(s.$slots,"aside")]),"aside-custom":l(()=>[e(s.$slots,"aside-custom")]),default:l(()=>[e(s.$slots,"default")]),_:3},8,["frontmatter"])}}};export{$t as default};
